[1,"── \u001B[1mAttaching core tidyverse packages\u001B[22m ──────────────────────── tidyverse 2.0.0 ──\n"]
[1,"\u001B[32m✔\u001B[39m \u001B[34mdplyr    \u001B[39m 1.1.4     \u001B[32m✔\u001B[39m \u001B[34mreadr    \u001B[39m 2.1.5\n"]
[1,"\u001B[32m✔\u001B[39m \u001B[34mforcats  \u001B[39m 1.0.0     \u001B[32m✔\u001B[39m \u001B[34mstringr  \u001B[39m 1.5.1\n"]
[1,"\u001B[32m✔\u001B[39m \u001B[34mggplot2  \u001B[39m 3.5.1     \u001B[32m✔\u001B[39m \u001B[34mtibble   \u001B[39m 3.2.1\n"]
[1,"\u001B[32m✔\u001B[39m \u001B[34mlubridate\u001B[39m 1.9.3     \u001B[32m✔\u001B[39m \u001B[34mtidyr    \u001B[39m 1.3.1\n"]
[1,"\u001B[32m✔\u001B[39m \u001B[34mpurrr    \u001B[39m 1.0.2     \n"]
[1,"── \u001B[1mConflicts\u001B[22m ────────────────────────────────────────── tidyverse_conflicts() ──\n"]
[1,"\u001B[31m✖\u001B[39m \u001B[34mdplyr\u001B[39m::\u001B[32mfilter()\u001B[39m masks \u001B[34mstats\u001B[39m::filter()\n"]
[1,"\u001B[31m✖\u001B[39m \u001B[34mdplyr\u001B[39m::\u001B[32mlag()\u001B[39m    masks \u001B[34mstats\u001B[39m::lag()\n"]
[1,"\u001B[36mℹ\u001B[39m Use the \u001B]8;;http://conflicted.r-lib.org/\u0007conflicted package\u001B]8;;\u0007 to force all conflicts to become errors\n"]
[2,"Loading required package: ggrepel\n"]
[2,"Loading required package: NULISAseqR\n"]
[2,"Loading required package: ComplexHeatmap\nLoading required package: grid\n"]
[2,"========================================\nComplexHeatmap version 2.20.0\nBioconductor page: http://bioconductor.org/packages/ComplexHeatmap/\nGithub page: https://github.com/jokergoo/ComplexHeatmap\nDocumentation: http://jokergoo.github.io/ComplexHeatmap-reference\n\nIf you use it in published research, please cite either one:\n- Gu, Z. Complex Heatmap Visualization. iMeta 2022.\n- Gu, Z. Complex heatmaps reveal patterns and correlations in multidimensional \n    genomic data. Bioinformatics 2016.\n\n\nThe new InteractiveComplexHeatmap package can directly export static \ncomplex heatmaps into an interactive Shiny app with zero effort. Have a try!\n\nThis message can be suppressed by:\n  suppressPackageStartupMessages(library(ComplexHeatmap))\n========================================\n\nLoading required package: foreach\n\nAttaching package: ‘foreach’\n\nThe following objects are masked from ‘package:purrr’:\n\n    accumulate, when\n\nLoading required package: iterators\nLoading required package: parallel\nLoading required package: lattice\n"]
[2,"\nAttaching package: ‘caret’\n\nThe following object is masked from ‘package:purrr’:\n\n    lift\n\n"]
[2,"Loading required package: Matrix\n\nAttaching package: ‘Matrix’\n\nThe following objects are masked from ‘package:tidyr’:\n\n    expand, pack, unpack\n\nLoaded glmnet 4.1-9\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m130250\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m12\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[31mchr\u001B[39m (10): Panel, PanelLotNumber, PlateID, SampleName, SampleType, Target, Al...\n"]
[1,"\u001B[32mdbl\u001B[39m  (2): LOD, NPQ\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m64604\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m12\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[31mchr\u001B[39m (10): Panel, PanelLotNumber, PlateID, SampleName, SampleType, Target, Al...\n"]
[1,"\u001B[32mdbl\u001B[39m  (2): LOD, NPQ\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"\u001B[1m\u001B[22m`summarise()` has grouped output by 'SampleName', 'Target'. You can override\n"]
[1,"using the `.groups` argument.\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m503\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m9\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[31mchr\u001B[39m (8): SampleName, SampleType, PlateID, BoASampleID, Sex, Race, Ethnicity,...\n"]
[1,"\u001B[32mdbl\u001B[39m (1): Age2\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"\u001B[1m\u001B[22m`summarise()` has grouped output by 'Sex'. You can override using the `.groups`\n"]
[1,"argument.\n"]
[1,"\u001B[1m\u001B[22m`summarise()` has grouped output by 'SampleName', 'Target'. You can override\n"]
[1,"using the `.groups` argument.\n"]
[2,"Type 'citation(\"pROC\")' for a citation.\n\nAttaching package: ‘pROC’\n\nThe following objects are masked from ‘package:stats’:\n\n    cov, smooth, var\n\n"]
[1,"[1] \"lm\"\n"]
[1,"[1] \"lightGBM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m288\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m13\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (13): ...1, j, error, rmse, cor, auc, num_leaves, max_depth, learning_ra...\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"[1] \"SVM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m2800\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m8\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, j, error, rmse, cor, auc, gamma, cost\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"Called from: eval(statements[[idx]], envir = globalenv())\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#271: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"    train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[2,"Warning messages:\n1: Unknown or uninitialised column: `num_iterations`. \n2: Unknown or uninitialised column: `early_stopping_rounds`. \n3: In dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n4: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n5: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#274: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#277: pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"    )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#282: pred.res\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#283: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#284: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#187: print(model.type)\n"]
[1,"[1] \"elastic.net\"\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#189: if (model.type == \"lm\") {\n"]
[1,"    if (test.fold.i > 5) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/lm.res/lm.feature.importance.csv\"))\n"]
[1,"        svm1$protein[1:20]\n"]
[1,"        lm.res = lm(as.formula(paste0(\"age ~ \", paste(svm1$protein[1:20], \n"]
[1,"            collapse = \"+\"))), data = train.comb.reformat %>% \n"]
[1,"            data.frame())\n"]
[1,"        predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(lm.res, \n"]
[1,"            train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"                \"age\"] %>% data.frame()), Age = train.comb.reformat[, \n"]
[1,"            \"age\"]))\n"]
[1,"        model.training\n"]
[1,"        pred.res <- predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        pred.res\n"]
[1,"        new.pred = coefficients(model.training)[\"pred.age\"] * \n"]
[1,"            pred.res + coefficients(model.training)[1]\n"]
[1,"        new.pred\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        next\n"]
[1,"    }\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#221: if (model.type == \"elastic.net\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"        lambda = sorted.res$lambda[j])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"    pred.res = pred.res[, 1]\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#222: if (test.fold.i < 6) {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"        test.fold.i, \".csv\"))\n"]
[1,"    sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"    j = 1\n"]
[1,"} else {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"    sorted.res = svm1\n"]
[1,"    j = 1\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#223: svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"    test.fold.i, \".csv\"))\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m1100\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m8\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, a, error, rmse, cor, auc, alpha, lambda\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#224: sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#225: j = 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#231: glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"    \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"    lambda = sorted.res$lambda[j])\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#237: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"    train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#240: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#241: pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#246: pred.res = pred.res[, 1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#247: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#248: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#254: if (model.type == \"SVM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    m_svm_untuned <- svm(formula = age ~ ., data = train.comb.reformat, \n"]
[1,"        gamma = sorted.res$gamma[j], cost = sorted.res$cost[j])\n"]
[1,"    browser()\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"        train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"        )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"\u001B[1m\u001B[22m`summarise()` has grouped output by 'SampleName', 'Target'. You can override\n"]
[1,"using the `.groups` argument.\n"]
[1,"[1] \"lm\"\n"]
[1,"[1] \"lightGBM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m288\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m13\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (13): ...1, j, error, rmse, cor, auc, num_leaves, max_depth, learning_ra...\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"[1] \"SVM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m2800\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m8\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, j, error, rmse, cor, auc, gamma, cost\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"Called from: eval(statements[[idx]], envir = globalenv())\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#271: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"    train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[2,"Warning messages:\n1: Unknown or uninitialised column: `num_iterations`. \n2: Unknown or uninitialised column: `early_stopping_rounds`. \n3: In dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n4: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n5: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#274: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#277: pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"    )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#282: pred.res\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#283: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#284: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#187: print(model.type)\n"]
[1,"[1] \"elastic.net\"\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#189: if (model.type == \"lm\") {\n"]
[1,"    if (test.fold.i > 5) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/lm.res/lm.feature.importance.csv\"))\n"]
[1,"        svm1$protein[1:20]\n"]
[1,"        lm.res = lm(as.formula(paste0(\"age ~ \", paste(svm1$protein[1:20], \n"]
[1,"            collapse = \"+\"))), data = train.comb.reformat %>% \n"]
[1,"            data.frame())\n"]
[1,"        predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(lm.res, \n"]
[1,"            train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"                \"age\"] %>% data.frame()), Age = train.comb.reformat[, \n"]
[1,"            \"age\"]))\n"]
[1,"        model.training\n"]
[1,"        pred.res <- predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        pred.res\n"]
[1,"        new.pred = coefficients(model.training)[\"pred.age\"] * \n"]
[1,"            pred.res + coefficients(model.training)[1]\n"]
[1,"        new.pred\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        next\n"]
[1,"    }\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#221: if (model.type == \"elastic.net\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"        lambda = sorted.res$lambda[j])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"    pred.res = pred.res[, 1]\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#222: if (test.fold.i < 6) {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"        test.fold.i, \".csv\"))\n"]
[1,"    sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"    j = 1\n"]
[1,"} else {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"    sorted.res = svm1\n"]
[1,"    j = 1\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#223: svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"    test.fold.i, \".csv\"))\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m1100\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m8\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, a, error, rmse, cor, auc, alpha, lambda\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#224: sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#225: j = 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#231: glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"    \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"    lambda = sorted.res$lambda[j])\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#237: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"    train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#240: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#241: pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#246: pred.res = pred.res[, 1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#247: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#248: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#254: if (model.type == \"SVM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    m_svm_untuned <- svm(formula = age ~ ., data = train.comb.reformat, \n"]
[1,"        gamma = sorted.res$gamma[j], cost = sorted.res$cost[j])\n"]
[1,"    browser()\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"        train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"        )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[1,"\u001B[1m\u001B[22m`summarise()` has grouped output by 'SampleName', 'Target'. You can override\n"]
[1,"using the `.groups` argument.\n"]
[1,"[1] \"lm\"\n"]
[1,"[1] \"lightGBM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m288\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m13\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (13): ...1, j, error, rmse, cor, auc, num_leaves, max_depth, learning_ra...\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"[1] \"SVM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m2800\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m8\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, j, error, rmse, cor, auc, gamma, cost\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"Called from: eval(statements[[idx]], envir = globalenv())\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#271: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"    train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[2,"Warning messages:\n1: Unknown or uninitialised column: `num_iterations`. \n2: Unknown or uninitialised column: `early_stopping_rounds`. \n3: In dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n4: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n5: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#274: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#277: pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"    )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#282: pred.res\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#283: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#284: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#187: print(model.type)\n"]
[1,"[1] \"elastic.net\"\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#189: if (model.type == \"lm\") {\n"]
[1,"    if (test.fold.i > 5) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/lm.res/lm.feature.importance.csv\"))\n"]
[1,"        svm1$protein[1:20]\n"]
[1,"        lm.res = lm(as.formula(paste0(\"age ~ \", paste(svm1$protein[1:20], \n"]
[1,"            collapse = \"+\"))), data = train.comb.reformat %>% \n"]
[1,"            data.frame())\n"]
[1,"        predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(lm.res, \n"]
[1,"            train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"                \"age\"] %>% data.frame()), Age = train.comb.reformat[, \n"]
[1,"            \"age\"]))\n"]
[1,"        model.training\n"]
[1,"        pred.res <- predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        pred.res\n"]
[1,"        new.pred = coefficients(model.training)[\"pred.age\"] * \n"]
[1,"            pred.res + coefficients(model.training)[1]\n"]
[1,"        new.pred\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        next\n"]
[1,"    }\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#221: if (model.type == \"elastic.net\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"        lambda = sorted.res$lambda[j])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"    pred.res = pred.res[, 1]\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#222: if (test.fold.i < 6) {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"        test.fold.i, \".csv\"))\n"]
[1,"    sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"    j = 1\n"]
[1,"} else {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"    sorted.res = svm1\n"]
[1,"    j = 1\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#223: svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"    test.fold.i, \".csv\"))\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m1100\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m8\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, a, error, rmse, cor, auc, alpha, lambda\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#224: sorted.res = svm1 %>% arrange(rmse)\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#225: j = 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#231: glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"    \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"    lambda = sorted.res$lambda[j])\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#237: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"    train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#240: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#241: pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#246: pred.res = pred.res[, 1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#247: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#248: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#254: if (model.type == \"SVM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    m_svm_untuned <- svm(formula = age ~ ., data = train.comb.reformat, \n"]
[1,"        gamma = sorted.res$gamma[j], cost = sorted.res$cost[j])\n"]
[1,"    browser()\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"        train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"        )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"\u001B[1m\u001B[22m`summarise()` has grouped output by 'SampleName', 'Target'. You can override\n"]
[1,"using the `.groups` argument.\n"]
[1,"[1] \"lm\"\n"]
[1,"[1] \"lightGBM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m288\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m13\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (13): ...1, j, error, rmse, cor, auc, num_leaves, max_depth, learning_ra...\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"[1] \"SVM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m2800\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m8\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, j, error, rmse, cor, auc, gamma, cost\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"Called from: eval(statements[[idx]], envir = globalenv())\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#271: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"    train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[2,"Warning messages:\n1: Unknown or uninitialised column: `num_iterations`. \n2: Unknown or uninitialised column: `early_stopping_rounds`. \n3: In dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n4: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n5: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#274: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#277: pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"    )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#282: pred.res\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#283: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#284: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#187: print(model.type)\n"]
[1,"[1] \"elastic.net\"\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#189: if (model.type == \"lm\") {\n"]
[1,"    if (test.fold.i > 5) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/lm.res/lm.feature.importance.csv\"))\n"]
[1,"        svm1$protein[1:20]\n"]
[1,"        lm.res = lm(as.formula(paste0(\"age ~ \", paste(svm1$protein[1:20], \n"]
[1,"            collapse = \"+\"))), data = train.comb.reformat %>% \n"]
[1,"            data.frame())\n"]
[1,"        predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(lm.res, \n"]
[1,"            train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"                \"age\"] %>% data.frame()), Age = train.comb.reformat[, \n"]
[1,"            \"age\"]))\n"]
[1,"        model.training\n"]
[1,"        pred.res <- predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        pred.res\n"]
[1,"        new.pred = coefficients(model.training)[\"pred.age\"] * \n"]
[1,"            pred.res + coefficients(model.training)[1]\n"]
[1,"        new.pred\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        next\n"]
[1,"    }\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#221: if (model.type == \"elastic.net\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"        lambda = sorted.res$lambda[j])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"    pred.res = pred.res[, 1]\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#222: if (test.fold.i < 6) {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"        test.fold.i, \".csv\"))\n"]
[1,"    sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"    j = 1\n"]
[1,"} else {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"    sorted.res = svm1\n"]
[1,"    j = 1\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#223: svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"    test.fold.i, \".csv\"))\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m1100\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m8\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, a, error, rmse, cor, auc, alpha, lambda\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#224: sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#225: j = 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#231: glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"    \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"    lambda = sorted.res$lambda[j])\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#237: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"    train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#240: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#241: pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#246: pred.res = pred.res[, 1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#247: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#248: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#254: if (model.type == \"SVM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    m_svm_untuned <- svm(formula = age ~ ., data = train.comb.reformat, \n"]
[1,"        gamma = sorted.res$gamma[j], cost = sorted.res$cost[j])\n"]
[1,"    browser()\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"        train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"        )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"\u001B[1m\u001B[22m`summarise()` has grouped output by 'SampleName', 'Target'. You can override\n"]
[1,"using the `.groups` argument.\n"]
[1,"[1] \"lm\"\n"]
[1,"[1] \"lightGBM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m288\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m13\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (13): ...1, j, error, rmse, cor, auc, num_leaves, max_depth, learning_ra...\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"[1] \"SVM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m2800\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m8\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, j, error, rmse, cor, auc, gamma, cost\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"Called from: eval(statements[[idx]], envir = globalenv())\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#271: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"    train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[2,"Warning messages:\n1: Unknown or uninitialised column: `num_iterations`. \n2: Unknown or uninitialised column: `early_stopping_rounds`. \n3: In dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n4: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n5: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#274: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#277: pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"    )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#282: pred.res\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#283: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#284: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#187: print(model.type)\n"]
[1,"[1] \"elastic.net\"\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#189: if (model.type == \"lm\") {\n"]
[1,"    if (test.fold.i > 5) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/lm.res/lm.feature.importance.csv\"))\n"]
[1,"        svm1$protein[1:20]\n"]
[1,"        lm.res = lm(as.formula(paste0(\"age ~ \", paste(svm1$protein[1:20], \n"]
[1,"            collapse = \"+\"))), data = train.comb.reformat %>% \n"]
[1,"            data.frame())\n"]
[1,"        predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(lm.res, \n"]
[1,"            train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"                \"age\"] %>% data.frame()), Age = train.comb.reformat[, \n"]
[1,"            \"age\"]))\n"]
[1,"        model.training\n"]
[1,"        pred.res <- predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        pred.res\n"]
[1,"        new.pred = coefficients(model.training)[\"pred.age\"] * \n"]
[1,"            pred.res + coefficients(model.training)[1]\n"]
[1,"        new.pred\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        next\n"]
[1,"    }\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#221: if (model.type == \"elastic.net\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"        lambda = sorted.res$lambda[j])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"    pred.res = pred.res[, 1]\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#222: if (test.fold.i < 6) {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"        test.fold.i, \".csv\"))\n"]
[1,"    sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"    j = 1\n"]
[1,"} else {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"    sorted.res = svm1\n"]
[1,"    j = 1\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#223: svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"    test.fold.i, \".csv\"))\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m1100\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m8\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, a, error, rmse, cor, auc, alpha, lambda\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#224: sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#225: j = 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#231: glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"    \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"    lambda = sorted.res$lambda[j])\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#237: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"    train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#240: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#241: pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#246: pred.res = pred.res[, 1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#247: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#248: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#254: if (model.type == \"SVM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    m_svm_untuned <- svm(formula = age ~ ., data = train.comb.reformat, \n"]
[1,"        gamma = sorted.res$gamma[j], cost = sorted.res$cost[j])\n"]
[1,"    browser()\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"        train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"        )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"\u001B[1m\u001B[22m`summarise()` has grouped output by 'SampleName', 'Target'. You can override\n"]
[1,"using the `.groups` argument.\n"]
[1,"[1] \"lm\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m322\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m7\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[31mchr\u001B[39m (1): protein\n"]
[1,"\u001B[32mdbl\u001B[39m (6): ...1, Estimate, Std..Error, t.value, Pr...t.., adj.pval\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"[1] \"lightGBM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m288\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m14\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[31mchr\u001B[39m  (1): list.rank\n"]
[1,"\u001B[32mdbl\u001B[39m (13): ...1, num_leaves, max_depth, learning_rate, feature_fraction, lamb...\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[1,"[1] \"SVM\"\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m2800\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m9\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[31mchr\u001B[39m (1): list.rank\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, gamma, cost, mean.rmse, mean.rank, rmse.rank, ranks.rank, mea...\n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"Called from: eval(statements[[idx]], envir = globalenv())\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#271: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"    train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[2,"Warning messages:\n1: In dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n2: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n3: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n4: Unknown or uninitialised column: `num_iterations`. \n5: Unknown or uninitialised column: `early_stopping_rounds`. \n6: In dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n7: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n8: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#274: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#277: pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"    )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#282: pred.res\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#283: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#284: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#187: print(model.type)\n"]
[1,"[1] \"elastic.net\"\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#189: if (model.type == \"lm\") {\n"]
[1,"    if (test.fold.i > 5) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/lm.res/lm.feature.importance.csv\"))\n"]
[1,"        svm1$protein[1:20]\n"]
[1,"        lm.res = lm(as.formula(paste0(\"age ~ \", paste(svm1$protein[1:20], \n"]
[1,"            collapse = \"+\"))), data = train.comb.reformat %>% \n"]
[1,"            data.frame())\n"]
[1,"        predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(lm.res, \n"]
[1,"            train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"                \"age\"] %>% data.frame()), Age = train.comb.reformat[, \n"]
[1,"            \"age\"]))\n"]
[1,"        model.training\n"]
[1,"        pred.res <- predict(lm.res, otherdata.wide %>% data.frame())\n"]
[1,"        pred.res\n"]
[1,"        new.pred = coefficients(model.training)[\"pred.age\"] * \n"]
[1,"            pred.res + coefficients(model.training)[1]\n"]
[1,"        new.pred\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        next\n"]
[1,"    }\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#221: if (model.type == \"elastic.net\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"        lambda = sorted.res$lambda[j])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"    pred.res = pred.res[, 1]\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#222: if (test.fold.i < 6) {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/both.model.\", \n"]
[1,"        test.fold.i, \".csv\"))\n"]
[1,"    sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"    j = 1\n"]
[1,"} else {\n"]
[1,"    svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"    sorted.res = svm1\n"]
[1,"    j = 1\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#227: svm1 = read_csv(paste0(\"figures/model.iter.12/elastic.net/both/aggregated.performance.rank.csv\"))\n"]
[1,"\u001B[1m\u001B[22mNew names:\n"]
[1,"\u001B[36m•\u001B[39m `` -> `...1`\n"]
[1,"\u001B[1mRows: \u001B[22m\u001B[34m1100\u001B[39m \u001B[1mColumns: \u001B[22m\u001B[34m9\u001B[39m\n"]
[1,"\u001B[36m──\u001B[39m \u001B[1mColumn specification\u001B[22m \u001B[36m────────────────────────────────────────────────────────\u001B[39m\n"]
[1,"\u001B[1mDelimiter:\u001B[22m \",\"\n"]
[1,"\u001B[31mchr\u001B[39m (1): list.rank\n"]
[1,"\u001B[32mdbl\u001B[39m (8): ...1, alpha, lambda, mean.rmse, mean.rank, rmse.rank, ranks.rank, m...\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
[1,"\u001B[36mℹ\u001B[39m Use `spec()` to retrieve the full column specification for this data.\n"]
[1,"\u001B[36mℹ\u001B[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#228: sorted.res = svm1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#229: j = 1\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#231: glm.manual = glmnet(x = train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"    \"age\"], y = train.comb.reformat[, \"age\"], alpha = sorted.res$alpha[j], \n"]
[1,"    lambda = sorted.res$lambda[j])\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#237: model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(glm.manual, \n"]
[1,"    train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"        \"age\"])[, 1], Age = train.comb.reformat[, \"age\"]))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#240: model.training\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#241: pred.res <- predict(glm.manual, otherdata.wide, )\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#246: pred.res = pred.res[, 1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#247: new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"    coefficients(model.training)[1]\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#248: new.pred\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#254: if (model.type == \"SVM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/SVM/both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    m_svm_untuned <- svm(formula = age ~ ., data = train.comb.reformat, \n"]
[1,"        gamma = sorted.res$gamma[j], cost = sorted.res$cost[j])\n"]
[1,"    browser()\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = predict(m_svm_untuned, \n"]
[1,"        train.comb.reformat), Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(m_svm_untuned, newdata = otherdata.wide, \n"]
[1,"        )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#288: if (model.type == \"lightGBM\") {\n"]
[1,"    if (test.fold.i < 6) {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM/both/both.model.\", \n"]
[1,"            test.fold.i, \".csv\"))\n"]
[1,"        sorted.res = svm1 %>% arrange(rmse)\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    else {\n"]
[1,"        svm1 = read_csv(paste0(\"figures/model.iter.12/lightGBM//both/aggregated.performance.rank.csv\"))\n"]
[1,"        sorted.res = svm1\n"]
[1,"        j = 1\n"]
[1,"    }\n"]
[1,"    train_lgb <- lightgbm::lgb.Dataset(train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"], label = train.comb.reformat[, \n"]
[1,"        \"age\"])\n"]
[1,"    vali_lgb <- lightgbm::lgb.Dataset.create.valid(train_lgb, \n"]
[1,"        train.comb.reformat[, !colnames(train.comb.reformat) %in% \n"]
[1,"            \"age\"], label = train.comb.reformat[, \"age\"])\n"]
[1,"    light_gbn_tuned <- lightgbm::lgb.train(params = list(objective = \"regression\", \n"]
[1,"        metric = \"rmse\", max_depth = sorted.res$max_depth[j], \n"]
[1,"        num_leaves = sorted.res$num_leaves[j], num_iterations = sorted.res$num_iterations[j], \n"]
[1,"        early_stopping_rounds = sorted.res$early_stopping_rounds[j], \n"]
[1,"        verbose = -1, learning_rate = sorted.res$learning_rate[j]), \n"]
[1,"        valids = list(vali = vali_lgb), data = train_lgb)\n"]
[1,"    yhat_fit_tuned <- predict(light_gbn_tuned, train.comb.reformat[, \n"]
[1,"        !colnames(train.comb.reformat) %in% \"age\"])\n"]
[1,"    model.training <- lm(Age ~ pred.age, data = data.frame(pred.age = yhat_fit_tuned, \n"]
[1,"        Age = train.comb.reformat[, \"age\"]))\n"]
[1,"    model.training\n"]
[1,"    pred.res <- predict(light_gbn_tuned, otherdata.wide, )\n"]
[1,"    pred.res\n"]
[1,"    new.pred = coefficients(model.training)[\"pred.age\"] * pred.res + \n"]
[1,"        coefficients(model.training)[1]\n"]
[1,"    new.pred\n"]
[1,"}\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#335: others.age = data.frame(SampleName = rownames(otherdata.wide)) %>% \n"]
[1,"    left_join(sample.annotate %>% select(SampleName, age) %>% \n"]
[1,"        distinct(), by = \"SampleName\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#337: others.age %>% head()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#338: others.age$age\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#340: pred.rmse = RMSE(pred.res, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#341: adj.pred.rmse = RMSE(new.pred, others.age$age, na.rm = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#342: model <- lm(pred.res ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#343: model.new <- lm(new.pred ~ others.age$age)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#344: r2 = summary(model)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#345: adj.r2 = summary(model.new)$r.squared\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#346: pred.cor = cor(pred.res, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#347: adj.pred.cor = cor(new.pred, others.age$age, use = \"c\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#352: plot.data = rbind(data.frame(pred.age = pred.res, chronological.age = others.age$age, \n"]
[1,"    type = \"org\"), data.frame(pred.age = new.pred, chronological.age = others.age$age, \n"]
[1,"    type = \"adjusted\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#355: p = plot.data %>% ggplot(aes(chronological.age, pred.age, color = type)) + \n"]
[1,"    geom_point() + geom_smooth(method = \"lm\") + geom_abline(slope = 1, \n"]
[1,"    intercept = 0) + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"RMSE: \", \n"]
[1,"    round(pred.rmse, 3)), hjust = -0.1, vjust = 2, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. RMSE: \", \n"]
[1,"    round(adj.pred.rmse, 3)), hjust = -0.1, vjust = 3.5, size = 5, \n"]
[1,"    color = \"blue\") + annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"R^2: \", \n"]
[1,"    round(r2, 3)), hjust = -0.1, vjust = 5, size = 5, color = \"orange\") + \n"]
[1,"    annotate(\"text\", x = -Inf, y = Inf, label = paste0(\"Adj. R^2: \", \n"]
[1,"        round(adj.r2, 3)), hjust = -0.1, vjust = 6.5, size = 5, \n"]
[1,"        color = \"orange\") + annotate(\"text\", x = -Inf, y = Inf, \n"]
[1,"    label = paste0(\"Corr: \", round(pred.cor, 3)), hjust = -0.1, \n"]
[1,"    vjust = 8, size = 5, color = \"green\") + annotate(\"text\", \n"]
[1,"    x = -Inf, y = Inf, label = paste0(\"Adj. Corr: \", round(adj.pred.cor, \n"]
[1,"        3)), hjust = -0.1, vjust = 9.5, size = 5, color = \"green\") + \n"]
[1,"    theme_bw(base_size = 15)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#375: basel.pred.folder = paste0(\"figures/prediction/basel.whole.training/\")\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#376: dir.create(basel.pred.folder, recursive = T)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#377: pdf(paste0(basel.pred.folder, \"rmse.\", model.type, \".\", test.fold.i, \n"]
[1,"    \".pdf\"))\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#378: print(p)\n"]
[1,"\u001B[1m\u001B[22m`geom_smooth()` using formula = 'y ~ x'\n"]
[2,"Warning message:\nIn dir.create(basel.pred.folder, recursive = T) :\n  'figures/prediction/basel.whole.training' already exists\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#379: dev.off()\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#381: res.table[[counter]] = data.frame(model = model.type, test.fold = test.fold.i, \n"]
[1,"    rmse = pred.rmse, adj.rmse = adj.pred.rmse, r2 = r2, adj.r2 = adj.r2, \n"]
[1,"    corr = pred.cor, adj.corr = adj.pred.cor)\n"]
[1,"debug at /Users/hhuang/Desktop/aging prediction/aging prediction scaled/scripts/03.03.basel.predict.whole.training.R#386: counter = counter + 1\n"]
[2,"Warning messages:\n1: \u001B[1m\u001B[22mRemoved 8 rows containing non-finite outside the scale range (`stat_smooth()`). \n2: \u001B[1m\u001B[22mRemoved 8 rows containing missing values or values outside the scale range\n(`geom_point()`). \n"]
